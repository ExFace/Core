{"version":3,"sources":["pivot_spec.coffee"],"names":["fixtureData","fixtureData2","describe","table","beforeEach","done","$","pivotUI","dataClass","pivotUtilities","SubtotalPivotData","renderers","subtotal_renderers","onRefresh","it","expect","find","length","toBe","val","text","join","data","rows","cols","aggregators","subtotal_aggregators","vals","rendererOptions","collapseColsAt","collapseRowsAt","rowSubtotalDisplay","hideOnExpand","colSubtotalDisplay","displayOnTop","attr","pivot","renderer","aggregator","sumOverSumOpts","filter","sorters","aoaInput","pd","getAggregator","value","aosInput","a","b","functionInput","record","tableInput","getRowKeys","toEqual","getColKeys","c","i","j","len","len1","numNotNull","numNull","r","ref","ref1","agg","results","s","spots","spot","format","hdr"],"mappings":"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","file":"pivot_spec.min.js","sourcesContent":["fixtureData = [\r\n    [\"name\",    \"gender\",   \"colour\",       \"birthday\",     \"trials\",   \"successes\"],\r\n    [\"Nick\",    \"male\",     \"blue\",         \"1982-11-07\",   103,        12],\r\n    [\"Jane\",    \"female\",   \"red\",          \"1982-11-08\",   95,         25],\r\n    [\"John\",    \"male\",     \"blue\",         \"1982-12-08\",   112,        30],\r\n    [\"Carol\",   \"female\",   \"yellow\",       \"1983-11-11\",   102,        14],\r\n    [\"Raj\",     \"male\",     \"blue\",         \"1982-11-07\",   103,        12],\r\n    [\"Rani\",    \"female\",   \"red\",          \"1982-11-08\",   95,         25],\r\n    [\"Joshi\",   \"male\",     \"blue\",         \"1982-12-09\",   112,        12],\r\n    [\"Vel\",     \"male\",     \"yellow\",       \"1982-12-01\",   112,        25],\r\n    [\"Sai\",     \"male\",     \"red\",          \"1982-11-08\",   112,        30],\r\n    [\"Geeth\",   \"female\",   \"blue\",         \"1982-12-03\",   112,        14],\r\n    [\"Malar\",   \"male\",     \"red\",          \"1982-11-05\",   112,        12],\r\n    [\"Nila\",    \"male\",     \"blue\",         \"1982-12-07\",   112,        25],\r\n    [\"Yaazhi\",  \"male\",     \"yellow\",       \"1982-12-06\",   112,        30],\r\n    [\"Mukhi\",   \"male\",     \"yellow\",       \"1982-11-07\",   112,        14]]\r\n\r\nfixtureData2 = [\r\n    [\"name\",    \"gender\",   \"colour\",    \"birthday\",     \"trials\",   \"successes\"],\r\n    [\"Nick\",    \"male\",     \"blue\",      \"1982-11-07\",   103,        12],\r\n    [\"Jane\",    \"female\",   \"red\",       \"1982-11-08\",   95,         25],\r\n    [\"John\",    \"male\",     \"blue\",      \"1982-12-08\",   112,        30],\r\n    [\"Carol\",   \"female\",   \"yellow\",    \"1983-12-08\",   102,        14]]\r\n\r\n\r\ndescribe \"$.pivotUI()\", ->\r\n    describe \"with no rows/cols, default count aggregator, subtotal renderer\",  ->\r\n        table = null\r\n\r\n        beforeEach (done) ->\r\n            table = $(\"<div>\").pivotUI fixtureData, {\r\n                dataClass: $.pivotUtilities.SubtotalPivotData,\r\n                renderers: $.pivotUtilities.subtotal_renderers,\r\n                onRefresh: done\r\n            }\r\n\r\n\r\n        it \"has all the basic UI elements\", (done) ->\r\n            expect table.find(\"td.pvtAxisContainer\").length\r\n            .toBe   3\r\n            expect table.find(\"td.pvtRendererArea\").length\r\n            .toBe   1\r\n            expect table.find(\"td.pvtVals\").length\r\n            .toBe   1\r\n            expect table.find(\"select.pvtRenderer\").length\r\n            .toBe   1\r\n            expect table.find(\"select.pvtAggregator\").length\r\n            .toBe   1\r\n            expect table.find(\"span.pvtAttr\").length\r\n            .toBe   6\r\n            expect table.find(\"th.pvtTotalLabel\").length\r\n            .toBe   1 \r\n            expect table.find(\"td.pvtGrandTotal\").length\r\n            .toBe   1 \r\n            done()\r\n\r\n        it \"reflects its inputs\", (done) ->\r\n            expect table.find(\"td.pvtUnused span.pvtAttr\").length\r\n            .toBe  6\r\n            expect table.find(\"select.pvtRenderer\").val()\r\n            .toBe  \"Table With Subtotal\"\r\n            expect table.find(\"select.pvtAggregator\").val()\r\n            .toBe  \"Count\"\r\n            done()\r\n\r\n        it \"renders a table\", (done) ->\r\n            expect table.find(\"table.pvtTable\").length\r\n            .toBe  1 \r\n            done()\r\n\r\n        describe \"its renderer output\", ->\r\n            it \"has the correct type and number of cells\", (done) ->\r\n                expect table.find(\"th.pvtTotalLabel\").length\r\n                .toBe  1 \r\n                expect table.find(\"td.pvtGrandTotal\").length\r\n                .toBe  1 \r\n                done()\r\n\r\n            it \"has the correct textual representation\", (done) ->\r\n                expect table.find(\"table.pvtTable\").text()\r\n                .toBe [\"Totals\", \"14\"].join(\"\")\r\n                done()\r\n\r\n            it \"has a correct grand total with data value\", (done) ->\r\n                expect table.find(\"td.pvtGrandTotal\").text()\r\n                .toBe  \"14\"\r\n                expect table.find(\"td.pvtGrandTotal\").data(\"value\")\r\n                .toBe  14\r\n                done()\r\n\r\n    describe \"with collapsed rows and cols, subtotal_aggregators\",  ->\r\n        table = null\r\n\r\n        beforeEach (done) ->\r\n            table = $(\"<div>\").pivotUI fixtureData, \r\n                dataClass: $.pivotUtilities.SubtotalPivotData,\r\n                rows: [\"gender\", \"colour\"],\r\n                cols: [\"birthday\", \"trials\"],\r\n                aggregators: $.pivotUtilities.subtotal_aggregators,\r\n                vals: [\"successes\"],\r\n                renderers: $.pivotUtilities.subtotal_renderers,\r\n                rendererOptions: {\r\n                    collapseColsAt: 0,\r\n                    collapseRowsAt: 0\r\n                },\r\n                onRefresh: done\r\n\r\n        it \"has all the basic UI elements\", (done) ->\r\n            expect table.find(\"td.pvtAxisContainer\").length\r\n            .toBe  3\r\n            expect table.find(\"td.pvtRendererArea\").length\r\n            .toBe  1\r\n            expect table.find(\"td.pvtVals\").length\r\n            .toBe  1\r\n            expect table.find(\"select.pvtRenderer\").length\r\n            .toBe  1\r\n            expect table.find(\"select.pvtAggregator\").length\r\n            .toBe  1\r\n            expect table.find(\"span.pvtAttr\").length\r\n            .toBe  6\r\n            done()\r\n\r\n        it \"reflects its inputs\", (done) ->\r\n            expect table.find(\"td.pvtUnused span.pvtAttr\").length\r\n            .toBe  2 \r\n            expect table.find(\"td.pvtRows span.pvtAttr\").length\r\n            .toBe  2 \r\n            expect table.find(\"td.pvtCols span.pvtAttr\").length\r\n            .toBe  2 \r\n            expect table.find(\"select.pvtRenderer\").val()\r\n            .toBe  \"Table With Subtotal\"\r\n            expect table.find(\"select.pvtAggregator\").val()\r\n            .toBe  \"Sum As Fraction Of Parent Row\"\r\n            done()\r\n\r\n        it \"renders a table\", (done) ->\r\n            expect table.find(\"table.pvtTable\").length\r\n            .toBe  1 \r\n            done()\r\n\r\n        describe \"its renderer output\", ->\r\n            it \"has the correct type and number of cells\", (done) ->\r\n                expect table.find(\"th.pvtAxisLabel\").length\r\n                .toBe  4 \r\n                expect table.find(\"th.pvtAxisLabel.collapsed\").length\r\n                .toBe  4 \r\n                expect table.find(\"th.pvtRowLabel.rowcollapsed\").length\r\n                .toBe  2\r\n                expect table.find(\"th.pvtColLabel.colcollapsed\").length\r\n                .toBe  10 \r\n                expect table.find(\"th.pvtTotalLabel.rowTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"th.pvtTotalLabel.colTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"td.pvtVal.pvtColSubtotal.pvtRowSubtotal\").length\r\n                .toBe  20 \r\n                expect table.find(\"td.pvtTotal.rowTotal.pvtRowSubtotal\").length\r\n                .toBe  2 \r\n                expect table.find(\"td.pvtTotal.colTotal.pvtColSubtotal\").length\r\n                .toBe  10 \r\n                expect table.find(\"td.pvtGrandTotal\").length\r\n                .toBe  1 \r\n                done()\r\n\r\n            it \"has the correct textual representation\", (done) ->\r\n                expect table.find(\"th.pvtColLabel\").text()\r\n                .toBe \" \\u25B6 1982-11-05 \\u25B6 1982-11-07 \\u25B6 1982-11-08 \\u25B6 1982-12-01 \\u25B6 1982-12-03 \\u25B6 1982-12-06 \\u25B6 1982-12-07 \\u25B6 1982-12-08 \\u25B6 1982-12-09 \\u25B6 1983-11-1111210311295112112112112112112112102\"\r\n                expect table.find(\"th.pvtRowLabel\").text()\r\n                .toBe \" \\u25B6 femaleblueredyellow \\u25B6 maleblueredyellow\"\r\n                done()\r\n\r\n            it \"has a correct spot-checked cell with data value\", (done) ->\r\n                expect table.find(\"td.pvtVal.pvtRowSubtotal.row0.col3.rowcol0.colcol1\").text()\r\n                .toBe  \"17.9%\"\r\n                expect table.find(\"td.pvtVal.pvtTotal.colTotal.pvtColSubtotal.col3.colcol0\").data(\"value\")\r\n                .toBe  (50+30)/280\r\n                done()\r\n\r\n    describe \"with row and col subtotal hidden on expand\",  ->\r\n        table = null\r\n\r\n        beforeEach (done) ->\r\n            table = $(\"<div>\").pivotUI fixtureData, \r\n                dataClass: $.pivotUtilities.SubtotalPivotData,\r\n                rows: [\"colour\", \"birthday\", \"name\"],\r\n                cols: [\"trials\", \"gender\", \"successes\"],\r\n                aggregators: $.pivotUtilities.subtotal_aggregators,\r\n                vals: [\"successes\"],\r\n                renderers: $.pivotUtilities.subtotal_renderers,\r\n                rendererOptions: {\r\n                    rowSubtotalDisplay: {\r\n                        hideOnExpand: true\r\n                    },\r\n                    colSubtotalDisplay: {\r\n                        hideOnExpand: true\r\n                    }\r\n                },\r\n                onRefresh: done\r\n\r\n        it \"has all the basic UI elements\", (done) ->\r\n            expect table.find(\"td.pvtAxisContainer\").length\r\n            .toBe  3\r\n            expect table.find(\"td.pvtRendererArea\").length\r\n            .toBe  1\r\n            expect table.find(\"td.pvtVals\").length\r\n            .toBe  1\r\n            expect table.find(\"select.pvtRenderer\").length\r\n            .toBe  1\r\n            expect table.find(\"select.pvtAggregator\").length\r\n            .toBe  1\r\n            expect table.find(\"span.pvtAttr\").length\r\n            .toBe  6\r\n            done()\r\n\r\n        it \"reflects its inputs\", (done) ->\r\n            expect table.find(\"td.pvtUnused span.pvtAttr\").length\r\n            .toBe  0 \r\n            expect table.find(\"td.pvtRows span.pvtAttr\").length\r\n            .toBe  3 \r\n            expect table.find(\"td.pvtCols span.pvtAttr\").length\r\n            .toBe  3 \r\n            expect table.find(\"select.pvtRenderer\").val()\r\n            .toBe  \"Table With Subtotal\"\r\n            expect table.find(\"select.pvtAggregator\").val()\r\n            .toBe  \"Sum As Fraction Of Parent Row\"\r\n            done()\r\n\r\n        it \"renders a table\", (done) ->\r\n            expect table.find(\"table.pvtTable\").length\r\n            .toBe  1 \r\n            done()\r\n\r\n        describe \"its renderer output\", ->\r\n            it \"has the correct type and number of cells\", (done) ->\r\n                expect table.find(\"th.pvtAxisLabel\").length\r\n                .toBe  6\r\n                expect table.find(\"th.pvtAxisLabel.collapsed\").length\r\n                .toBe  0\r\n                expect table.find(\"th.pvtRowLabel.rowshow.rowcollapsed\").length\r\n                .toBe  0\r\n                expect table.find(\"th.pvtColLabel.colshow.colcollapsed\").length\r\n                .toBe  0\r\n                expect table.find(\"th.pvtRowLabel.rowshow.rowexpanded\").length\r\n                .toBe  28\r\n                expect table.find(\"th.pvtColLabel.colshow.colexpanded\").length\r\n                .toBe  17\r\n                expect table.find(\"th.pvtRowLabelFiller.rowhide.rowexpanded\").length\r\n                .toBe  14\r\n                expect table.find(\"th.pvtColLabelFiller.colhide.colexpanded\").length\r\n                .toBe  9 \r\n                expect table.find(\"td.pvtColSubtotal.pvtRowSubtotal.colhide.colexpanded.rowhide.rowexpanded\").length\r\n                .toBe  9*14 \r\n                expect table.find(\"th.pvtTotalLabel.rowTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"th.pvtTotalLabel.colTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"td.pvtTotal.rowTotal.pvtRowSubtotal\").length\r\n                .toBe  14 \r\n                expect table.find(\"td.pvtTotal.colTotal.pvtColSubtotal\").length\r\n                .toBe  9\r\n                expect table.find(\"td.pvtGrandTotal\").length\r\n                .toBe  1 \r\n                done()\r\n\r\n            it \"has the correct textual representation\", (done) ->\r\n                expect table.find(\"th.pvtColLabel\").text()\r\n                .toBe \" \\u25E2 95 \\u25E2 102 \\u25E2 103 \\u25E2 112 \\u25E2 female \\u25E2 female \\u25E2 male \\u25E2 female \\u25E2 male2514121412142530\"\r\n                expect table.find(\"th.pvtRowLabel\").text()\r\n                .toBe \" \\u25E2 blue \\u25E2 1982-11-07NickRaj \\u25E2 1982-12-03Geeth \\u25E2 1982-12-07Nila \\u25E2 1982-12-08John \\u25E2 1982-12-09Joshi \\u25E2 red \\u25E2 1982-11-05Malar \\u25E2 1982-11-08JaneRaniSai \\u25E2 yellow \\u25E2 1982-11-07Mukhi \\u25E2 1982-12-01Vel \\u25E2 1982-12-06Yaazhi \\u25E2 1983-11-11Carol\"\r\n                done()\r\n\r\n            it \"has a correct spot-checked cell with data value\", (done) ->\r\n                expect table.find(\"td.pvtVal.rowshow.colshow.row10.col5.rowcol2.colcol2\").text()\r\n                .toBe  \"100.0%\"\r\n                expect table.find(\"td.pvtVal[data-rownode=\\\"1\\\"][data-colnode=\\\"6\\\"]\").text()\r\n                .toBe  \"50.0%\"\r\n                done()\r\n\r\n    describe \"with row subtotal displayed at bottom\",  ->\r\n        table = null\r\n\r\n        beforeEach (done) ->\r\n            table = $(\"<div>\").pivotUI fixtureData, \r\n                dataClass: $.pivotUtilities.SubtotalPivotData,\r\n                rows: [\"colour\", \"birthday\"],\r\n                cols: [\"gender\", \"successes\"]\r\n                vals: [\"successes\"],\r\n                renderers: $.pivotUtilities.subtotal_renderers,\r\n                rendererOptions: {\r\n                    rowSubtotalDisplay: {\r\n                        displayOnTop: false\r\n                    }\r\n                },\r\n                onRefresh: done\r\n\r\n        it \"has all the basic UI elements\", (done) ->\r\n            expect table.find(\"td.pvtAxisContainer\").length\r\n            .toBe  3\r\n            expect table.find(\"td.pvtRendererArea\").length\r\n            .toBe  1\r\n            expect table.find(\"td.pvtVals\").length\r\n            .toBe  1\r\n            expect table.find(\"select.pvtRenderer\").length\r\n            .toBe  1\r\n            expect table.find(\"select.pvtAggregator\").length\r\n            .toBe  1\r\n            expect table.find(\"span.pvtAttr\").length\r\n            .toBe  6\r\n            done()\r\n\r\n        it \"reflects its inputs\", (done) ->\r\n            expect table.find(\"td.pvtUnused span.pvtAttr\").length\r\n            .toBe  2 \r\n            expect table.find(\"td.pvtRows span.pvtAttr\").length\r\n            .toBe  2 \r\n            expect table.find(\"td.pvtCols span.pvtAttr\").length\r\n            .toBe  2 \r\n            expect table.find(\"select.pvtRenderer\").val()\r\n            .toBe  \"Table With Subtotal\"\r\n            done()\r\n\r\n        it \"renders a table\", (done) ->\r\n            expect table.find(\"table.pvtTable\").length\r\n            .toBe  1 \r\n            done()\r\n\r\n        describe \"its renderer output\", ->\r\n            it \"has the correct type and number of cells\", (done) ->\r\n                expect table.find(\".pvtTable tbody tr:first-child th\").length\r\n                .toBe  1\r\n                expect table.find(\".pvtTable tbody tr:first-child th\").attr(\"rowspan\")\r\n                .toBe  \"7\"\r\n                expect table.find(\"tr:nth-child(7) th.pvtRowLabelFiller\").length\r\n                .toBe  1\r\n                expect table.find(\"th.pvtTotalLabel.rowTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"th.pvtTotalLabel.colTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"td.pvtTotal.rowTotal.pvtRowSubtotal\").length\r\n                .toBe  3 \r\n                expect table.find(\"td.pvtTotal.colTotal.pvtColSubtotal\").length\r\n                .toBe  2\r\n                expect table.find(\"td.pvtGrandTotal\").length\r\n                .toBe  1 \r\n                done()\r\n\r\n            it \"has the correct textual representation\", (done) ->\r\n                expect table.find(\"th.pvtColLabel\").text()\r\n                .toBe \" \\u25E2 female \\u25E2 male142512142530\"\r\n                expect table.find(\"th.pvtRowLabel\").text()\r\n                .toBe \" \\u25E2 blue1982-11-071982-12-031982-12-071982-12-081982-12-09 \\u25E2 red1982-11-051982-11-08 \\u25E2 yellow1982-11-071982-12-011982-12-061983-11-11\"\r\n                done()\r\n\r\n            it \"has a correct spot-checked cell with data value\", (done) ->\r\n                expect table.find(\"tr:nth-child(7) td.pvtTotal\").text()\r\n                .toBe  \"6\"\r\n                expect table.find(\"td.pvtVal.row5.rowcol0.pvtRowSubtotal.col0.colcol0.pvtColSubtotal\").text()\r\n                .toBe  \"2\"\r\n                expect table.find(\"td.pvtVal[data-rownode=\\\"13\\\"][data-colnode=\\\"7\\\"]\").text()\r\n                .toBe  \"3\"\r\n                done()\r\n\r\ndescribe \"$.pivot()\", ->\r\n    describe \"with no rows/cols, default count aggregator, subtotal renderer\",  ->\r\n        table = $(\"<div>\").pivot fixtureData, {\r\n            dataClass: $.pivotUtilities.SubtotalPivotData,\r\n            renderer: $.pivotUtilities.subtotal_renderers[\"Table With Subtotal\"]\r\n        }\r\n\r\n        it \"has all the basic UI elements\", ->\r\n            expect table.find(\"th.pvtTotalLabel\").length\r\n            .toBe   1 \r\n            expect table.find(\"td.pvtGrandTotal\").length\r\n            .toBe   1 \r\n\r\n        it \"renders a table\", ->\r\n            expect table.find(\"table.pvtTable\").length\r\n            .toBe  1 \r\n\r\n        describe \"its renderer output\", ->\r\n            it \"has the correct type and number of cells\", ->\r\n                expect table.find(\"th.pvtTotalLabel\").length\r\n                .toBe  1 \r\n                expect table.find(\"td.pvtGrandTotal\").length\r\n                .toBe  1 \r\n\r\n            it \"has the correct textual representation\", ->\r\n                expect table.find(\"table.pvtTable\").text()\r\n                .toBe [\"Totals\", \"14\"].join(\"\")\r\n\r\n            it \"has a correct grand total with data value\", ->\r\n                expect table.find(\"td.pvtGrandTotal\").text()\r\n                .toBe  \"14\"\r\n                expect table.find(\"td.pvtGrandTotal\").data(\"value\")\r\n                .toBe  14\r\n\r\n    describe \"with rows/cols, subtotal_aggregator\",  ->\r\n        table = $(\"<div>\").pivot fixtureData, \r\n            dataClass: $.pivotUtilities.SubtotalPivotData,\r\n            rows: [\"gender\", \"colour\"],\r\n            cols: [\"birthday\", \"trials\"],\r\n            aggregator: $.pivotUtilities.subtotal_aggregators[\"Sum As Fraction Of Parent Column\"]([\"successes\"]),\r\n            renderer: $.pivotUtilities.subtotal_renderers[\"Table With Subtotal\"]\r\n\r\n        it \"renders a table\", ->\r\n            expect table.find(\"table.pvtTable\").length\r\n            .toBe  1 \r\n\r\n        describe \"its renderer output\", ->\r\n            it \"has the correct type and number of cells\", ->\r\n                expect table.find(\"th.pvtAxisLabel\").length\r\n                .toBe  4 \r\n                expect table.find(\"th.collapsed\").length\r\n                .toBe  0 \r\n                expect table.find(\"th.expanded, th.rowexpanded, th.colexpanded\").length\r\n                .toBe  4+(2*5)+(10*2)+12 \r\n                expect table.find(\"th.pvtAxisLabel.expanded\").length\r\n                .toBe  4\r\n                expect table.find(\"th.pvtRowLabel.rowexpanded\").length\r\n                .toBe  8\r\n                expect table.find(\"th.pvtColLabel.colexpanded\").length\r\n                .toBe  22 \r\n                expect table.find(\"th.pvtTotalLabel.rowTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"th.pvtTotalLabel.colTotal\").length\r\n                .toBe  1 \r\n                expect table.find(\"td.pvtVal.pvtColSubtotal.pvtRowSubtotal\").length\r\n                .toBe  20 \r\n                expect table.find(\"td.pvtTotal.rowTotal.pvtRowSubtotal\").length\r\n                .toBe  2 \r\n                expect table.find(\"td.pvtTotal.colTotal.pvtColSubtotal\").length\r\n                .toBe  10 \r\n                expect table.find(\"td.pvtGrandTotal\").length\r\n                .toBe  1 \r\n\r\n            it \"has the correct textual representation\", ->\r\n                expect table.find(\"th.pvtColLabel\").text()\r\n                .toBe \" \\u25E2 1982-11-05 \\u25E2 1982-11-07 \\u25E2 1982-11-08 \\u25E2 1982-12-01 \\u25E2 1982-12-03 \\u25E2 1982-12-06 \\u25E2 1982-12-07 \\u25E2 1982-12-08 \\u25E2 1982-12-09 \\u25E2 1983-11-1111210311295112112112112112112112102\"\r\n                expect table.find(\"th.pvtRowLabel\").text()\r\n                .toBe \" \\u25E2 femaleblueredyellow \\u25E2 maleblueredyellow\"\r\n\r\n            it \"has a correct spot-checked cell with data value\", ->\r\n                expect table.find(\"td.pvtVal.pvtTotal.colTotal.col3.colcol1\").text()\r\n                .toBe  \"62.5%\"\r\n                expect table.find(\"td.pvtVal.pvtTotal.colTotal.col4.colcol1\").data(\"value\")\r\n                .toBe  30/80\r\n\r\ndescribe \"$.pivotUtilities\", ->\r\n\r\n    describe \".SubtotalPivotData()\", ->\r\n        sumOverSumOpts = \r\n            rows: [], cols: []\r\n            aggregator: $.pivotUtilities.aggregators[\"Sum over Sum\"]([\"a\",\"b\"])\r\n            filter: -> true\r\n            sorters: ->\r\n\r\n        describe \"with array-of-array input\", ->\r\n            aoaInput =  [ [\"a\",\"b\"], [1,2], [3,4] ]\r\n            pd = new $.pivotUtilities.SubtotalPivotData aoaInput, sumOverSumOpts\r\n\r\n            it \"has the correct grand total value\", ->\r\n                expect pd.getAggregator([],[]).value()\r\n                .toBe (1+3)/(2+4)\r\n\r\n        describe \"with array-of-object input\", ->\r\n            aosInput =  [ {a:1, b:2}, {a:3, b:4} ]\r\n            pd = new $.pivotUtilities.SubtotalPivotData aosInput, sumOverSumOpts\r\n\r\n            it \"has the correct grand total value\", ->\r\n                expect pd.getAggregator([],[]).value()\r\n                .toBe (1+3)/(2+4)\r\n\r\n        describe \"with function input\", ->\r\n            functionInput = (record) ->\r\n                record a:1, b:2\r\n                record a:3, b:4\r\n            pd = new $.pivotUtilities.SubtotalPivotData functionInput, sumOverSumOpts\r\n\r\n            it \"has the correct grand total value\", ->\r\n                expect pd.getAggregator([],[]).value()\r\n                .toBe (1+3)/(2+4)\r\n\r\n        describe \"with jQuery table element input\", ->\r\n            tableInput = $ \"\"\"\r\n                <table>\r\n                    <thead> \r\n                        <tr> <th>a</th><th>b</th> </tr>\r\n                    </thead> \r\n                    <tbody>\r\n                        <tr> <td>1</td> <td>2</td> </tr>\r\n                        <tr> <td>3</td> <td>4</td> </tr>\r\n                    </tbody>\r\n                </table>\r\n                \"\"\"\r\n\r\n            pd = new $.pivotUtilities.SubtotalPivotData tableInput, sumOverSumOpts\r\n\r\n            it \"has the correct grand total value\", ->\r\n                expect pd.getAggregator([],[]).value()\r\n                .toBe (1+3)/(2+4)\r\n\r\n\r\n        describe \"with rows/cols, no filters/sorters, count aggregator\", ->\r\n            pd = new $.pivotUtilities.SubtotalPivotData fixtureData2, \r\n                rows: [\"name\", \"colour\"], \r\n                cols: [\"trials\", \"successes\"],\r\n                aggregator: $.pivotUtilities.aggregators[\"Count\"](),\r\n                filter: -> true\r\n                sorters: ->\r\n\r\n            it \"has correctly-ordered row keys\", ->\r\n                expect pd.getRowKeys()\r\n                .toEqual [ [ 'Carol', 'yellow' ], [ 'Jane', 'red' ], [ 'John', 'blue' ], [ 'Nick', 'blue' ] ]\r\n               \r\n            it \"has correctly-ordered col keys\", ->\r\n                expect pd.getColKeys()\r\n                .toEqual [ [ 95, 25 ], [ 102, 14 ], [ 103, 12 ], [ 112, 30 ] ]\r\n\r\n            it \"can be iterated over\", ->\r\n                numNotNull = 0\r\n                numNull = 0\r\n                for r in pd.getRowKeys()\r\n                    for c in pd.getColKeys()\r\n                        if pd.getAggregator(r, c).value()?\r\n                            numNotNull++ \r\n                        else\r\n                            numNull++\r\n                expect numNotNull\r\n                .toBe 4\r\n                expect numNull\r\n                .toBe 12\r\n\r\n            it \"has a correct spot-checked aggregator\", ->\r\n                spots = [ {spot: [['Carol', 'yellow'], [102, 14]], val: 1}, {spot:  [['Jane', 'red'], [95, 25]], val: 1}, {spot: [['John', 'blue'], [112, 30]], val: 1}, {spot: [['Nick', 'blue'], [103, 12]], val: 1} ]\r\n                for s in spots\r\n                    agg = pd.getAggregator(s.spot[0],s.spot[1])\r\n                    val = agg.value()\r\n                    expect(val).toBe 1 \r\n                    expect(agg.format(val)).toBe \"\" + s.val\r\n\r\n            it \"has correct spot-checked aggregators for subtotal-rows and subtotal-columns\", ->\r\n                spots = [ {spot: [['Carol'], [102]], val: 1}, {spot:  [['Jane'], [95]], val: 1}, {spot: [['John'], [112]], val: 1}, {spot: [['Nick'], [103]], val: 1} ]\r\n                for s in spots\r\n                    agg = pd.getAggregator(s.spot[0], s.spot[1])\r\n                    val = agg.value()\r\n                    expect(val).toBe s.val \r\n                    expect(agg.format(val)).toBe \"\" + s.val\r\n\r\n            it \"has correct row-total for subtotal-rows\", ->\r\n                for hdr in ['Carol', 'Jane', 'John', 'Nick']\r\n                    agg = pd.getAggregator([hdr],[])\r\n                    val = agg.value()\r\n                    expect(val).toBe 1\r\n                    expect(agg.format(val)).toBe \"1\"\r\n\r\n            it \"has correct column-total for subtotal-columns\", ->\r\n                for hdr in [95, 102, 103, 112]\r\n                    agg = pd.getAggregator([],[hdr])\r\n                    val = agg.value()\r\n                    expect(val).toBe 1\r\n                    expect(agg.format(val)).toBe \"1\"\r\n\r\n            it \"has a correct grand total aggregator\", ->\r\n                agg = pd.getAggregator([],[])\r\n                val = agg.value()\r\n                expect(val).toBe 4 \r\n                expect(agg.format(val)).toBe \"4\"\r\n"]}